veth-pair 虚拟网卡对
每个节点都会有个cni0,一般都是24为掩码,但网段不同,10.244.1.1,10.244.2.1,分配给他的pod的ip也不同
brctl show 查看cni0等网桥的interface,其实就是veth-pair的某一端,接在交换机上
docker0也是
网桥,连接,



exec进一个pod看路由表,10.244.0.0由gateway10.244.0.1发出,这个其实就是pod所在的节点cni0网桥(首先网桥和这个发出在同一网段)
0.0.0.也就是默认路由比如ping百度,也是由gateway10.244.0.1发出
相应的网络接口一般是eth0(这个一般是veth-pair设备的另一端),单网卡一般没事,如果是多网卡要设置好了
cni0网桥类似三层交换机,带路由转发功能(路由器功能)
交换机口多,转发快,路由器口少,但有路由转发功能

veth-pair设备最大的特性就是数据到任意一端等于到了另一端,可以用来实现跨名称空间通信(pod和pod,pod和主机)
pod如果不是制定了hostNetwork=true那么就是使用主机的网络ns,协议栈,ip mac 网络接口 路由表


其实通信,只要四元组齐备即可,往往mac由交换机去arp,一般不会网发出的端口去arp,但可以通过发夹模式来设置(hair)

ping某个pod的ip,或者其他节点的cni0或者其他节点的pod比如10.244.1.3,然后arp -a可以看到它的mac地址,正常,进入目标容器看到网卡eth网卡的mac是正确的
交换机会学习也就是缓存下mac地址 brctl showmacs cni0杰克看到交换机学习的mac
访问这个目标pod地址,看看路由表,一般是0.0.0.0gateway也就是自身直接发出去的,说明了10.244.1.3是同一个网段的
10.244.0.0或者其他ip一般是通过当前节点的cni0来转发




查看pod的虚拟网卡对的一段比如eth0对应的cni0网桥哪个接口也就是另一个网卡
1.进入pod ethtool -s eth0拿到perr_ifindex比如10
2.ip a的10号网卡就是,一般veth开头



veth-pair就是用来实现跨ns的通信,两端也是网卡,同一个节点的pod的veth-pair同一个cni0管理